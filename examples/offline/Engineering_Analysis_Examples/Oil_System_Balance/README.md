# Oil System Balance Workflow

This folder contains a lightweight walkthrough for agents who need to brief
customers on oil system volume stability using FMU Gateway outputs. The helper
script keeps a validated snapshot on hand for quick reviews while still
prioritising the paid FMU Gateway run whenever the service is reachable.

## Files

- `oil_system_dynamic_simulation.csv` – time history exported from a previous
  FMU Gateway run.
- `run_example.py` – helper script that analyses the CSV, checks gateway health,
  and rehearses the payment quote flow.
- `outputs/` – generated summaries (JSON + Markdown). The directory is kept in
  source control with a `.gitignore` so new runs stay local.

## Usage

1. Ensure the Python SDK is available (`pip install -e ./sdk/python`).
2. Execute the workflow (using the packaged, previously validated dataset by default):
   ```bash
   python examples/offline/Engineering_Analysis_Examples/Oil_System_Balance/run_example.py
   ```
3. Review the generated Markdown brief under
   `examples/offline/Engineering_Analysis_Examples/Oil_System_Balance/outputs/`.

The script records that the results came from the archived FMU Gateway run so
you can still brief stakeholders even when a deployment is unavailable. When a
gateway is reachable, you should use it to produce a fresh, validated data set:

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
python examples/offline/Engineering_Analysis_Examples/Oil_System_Balance/run_example.py \
  --simulate-fmu /path/to/OilSystem.fmu \
  --payment-token <token_from_wallet> \
  --payment-method stripe_card
```

The helper will execute the FMU via the gateway, capture the payment response,
and switch the analysis to the CSV generated by the paid run. Add
`--quote-only` when you just need to surface the 402 payload without executing
the model.

To rehearse the FMU Gateway health check and 402-style payment quote using the
bundled reference FMU (without running the oil system model), add `--online`:

```bash
python examples/offline/Engineering_Analysis_Examples/Oil_System_Balance/run_example.py --online
```

The Markdown summary will include the outcome of the quote rehearsal and any
gateway simulation that ran during the session.

## How the calculation works

The helper script does **not** depend on Fly.io. Instead, it reads the
`oil_system_dynamic_simulation.csv` data set that shipped with the example and
derives a concise set of statistics entirely on your workstation:

- time step quality (mean/max Δt)
- engine-speed coverage across predefined RPM bands
- oil volume extrema, variation, and per-step change limits
- a qualitative assessment based on the 6 L safety threshold

The optional `--online` flag simply confirms that a gateway is reachable and
exercises the CLI quote flow to surface any authentication hurdles ahead of
time. If you have decommissioned your Fly.io deployment you can omit the flag
and the analysis will complete using only the packaged CSV.
