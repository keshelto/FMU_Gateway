# fly.toml app configuration file generated for fmu-gateway-long-pine-7571 on 2025-10-16T19:08:04+01:00
#
# See https://fly.io/docs/reference/configuration/ for information about how to use this file.
#

app = "fmu-gateway-long-pine-7571"  # Use the auto-generated app name from Step 2
primary_region = "iad"  # Replace with your selected region if different (e.g., iad, ord)

[build]
dockerfile = "Dockerfile"

[[services]]
internal_port = 8080
protocol = "tcp"
auto_stop_machines = false  # Disable auto-stop to keep app always-on
auto_start_machines = false  # Disable auto-start (manual control if needed)
min_machines_running = 1  # Ensure at least 1 machine always runs
processes = ["app"]

# HTTP service (redirect to HTTPS)
[[services.ports]]
port = 80
handlers = ["http"]
force_https = true

# HTTPS service
[[services.ports]]
port = 443
handlers = ["http", "tls"]

[[services.http_checks]]
interval = "10s"
timeout = "2s"
grace_period = "5s"
method = "GET"
path = "/"
protocol = "http"

[services.concurrency]
type = "connections"
hard_limit = 25
soft_limit = 20

# Environment variables can be set here if needed, but use fly secrets for sensitive ones like STRIPE keys
[env]
PORT = "8080"
FMU_GATEWAY_DB_PATH = '/data/fmu_gateway.sqlite3'
PUBLIC_BASE_URL = 'https://fmu-gateway-long-pine-7571.fly.dev'
STRIPE_SIMULATION_CURRENCY = 'usd'
STRIPE_SIMULATION_PRICE_CENTS = '100'

[[vm]]
  memory = '1gb'
  cpu_kind = 'shared'
  cpus = 1
