# Flexible Compound Gear – Friction Ring Thermo-Mechanical-Wear Co-Sim

This example packages a lightweight, fully scripted reproduction of the
analysis workflow requested by the customer brief. The goal is to help agents
explain the co-simulation setup, rehearse the KPI logic, and generate the
required plots even when an FMU Gateway deployment is offline. The helper script
uses a simplified physics surrogate that captures the same variable flow between
FMUs that the production workflow would exercise:

1. **TorsionalDriveTrain** – integrates the crank/cam torsional dynamics,
   exposes the slip rate and normal force acting on the beryllium-copper (BeCu)
   ring.
2. **FrictionRing** – applies temperature dependent friction and Stribeck
   blending to compute frictional power and torque.
3. **FlashTemp** – estimates flash temperatures using a moving heat source
   approximation.
4. **ThermalNetwork** – integrates ring/steel bulk temperatures using a two-node
   lumped parameter model.
5. **WearEstimator** – evaluates the Archard wear rate and cumulative thickness
   loss.
6. **Logger** – records the requested time histories and KPI checkpoints.

The surrogate shares the same inputs/outputs as the requested FMUs so the
resulting data products remain faithful to the briefing needs, while remaining
transparent and fast to execute on a laptop.

## Files

- `engine_cam_drive_cycle.csv` – engine speed and cam torque trace applied to
  the torsional model. The helper will use this data when the gateway is not
  reachable.
- `run_example.py` – orchestrates the co-simulation surrogate, sweeps, plotting,
  KPI calculations, and summary report generation.
- `outputs/` – example artefacts generated by the helper. The directory ships
  with a git-ignored placeholder so that fresh runs remain local unless you
  commit them intentionally.

## Usage

Create a virtual environment, install the Python SDK (to mirror the end-user
workflow), and execute the helper:

```bash
python -m venv .venv
source .venv/bin/activate
pip install -e ./sdk/python
python Engineering_Analysis_Examples/Flexible_Compound_Gear/run_example.py
```

By default the helper operates in **offline** mode – it consumes the packaged
`engine_cam_drive_cycle.csv` and generates the plots/summary under
`Engineering_Analysis_Examples/Flexible_Compound_Gear/outputs/`.

When an FMU Gateway deployment is reachable you can execute the same script with
`--online` and point it at the six FMUs requested in the brief. The script will
call the gateway, record payment/quote metadata, and switch the analysis to the
freshly generated results. The offline surrogate remains available for quick
briefings and unit tests.

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
python Engineering_Analysis_Examples/Flexible_Compound_Gear/run_example.py \
  --simulate-fmu /path/to/TorsionalDriveTrain.fmu \
  --simulate-fmu /path/to/FrictionRing.fmu \
  --simulate-fmu /path/to/FlashTemp.fmu \
  --simulate-fmu /path/to/ThermalNetwork.fmu \
  --simulate-fmu /path/to/WearEstimator.fmu \
  --simulate-fmu /path/to/Logger.fmu \
  --payment-token <token_from_wallet> \
  --payment-method stripe_card
```

Add `--quote-only` to rehearse the payment flow without executing the FMUs. The
Markdown summary will capture whether data came from the offline surrogate or a
real gateway run.

## Outputs

The helper produces the artefacts promised in the brief:

- time histories: `T_ring_bulk`, `T_surface_peak`, `mu(T)`, `Q_fric`, `h_wear`
- KPI table with temperature duty fractions and wear-life projections
- a 2D contour map of predicted service life vs. `(h_oil, N)` at nominal
  friction
- a Markdown summary providing the pass/fail verdict and recommended levers

When running offline you can inspect the packaged example artefacts under
`outputs/reference_offline_run/`. The repository only carries the CSV/JSON/MD
references so that pull requests remain text-only; rerun the helper locally to
regenerate the PNG plots as needed.
